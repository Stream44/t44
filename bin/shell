#!/usr/bin/env bun

import { run } from '../workspace-rt'

await run(async ({ encapsulate, CapsulePropertyTypes, makeImportStack }: any) => {
    const spine = await encapsulate({
        '#@stream44.studio/encapsulate/spine-contracts/CapsuleSpineContract.v0': {
            '#@stream44.studio/encapsulate/structs/Capsule': {},
            '#': {
                cli: {
                    type: CapsulePropertyTypes.Mapping,
                    value: 't44/caps/WorkspaceShellCli'
                },
            }
        }
    }, {
        importMeta: import.meta,
        importStack: makeImportStack(),
        capsuleName: 't44/.workspace/bin/shell'
    })
    return { spine }
}, async ({ spine, apis }: any) => {

    const runCli = await apis[spine.capsuleSourceLineRef].cli.runCli

    await runCli(process.argv)
})
